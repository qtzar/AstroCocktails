---
import { getCollection } from 'astro:content';
import Layout from '@/layouts/Layout.astro';

const allCocktails = await getCollection('cocktails');

const sourceMap = new Map<string, number>();

for (const cocktail of allCocktails) {
    const source = cocktail.data.source?.trim();
    if (!source) continue;
    const key = source.toLowerCase();
    sourceMap.set(key, (sourceMap.get(key) ?? 0) + 1);
}

const methodIcons: Record<string, string> = {
    shaken: '🥶',
    stirred: '🧊',
    built: '🪜',
    swizzled: '🌪️',
    blended: '⚡',
};

const sources = Array.from(sourceMap.entries())
    .map(([name, count]) => ({
        name,
        displayName: name.charAt(0).toUpperCase() + name.slice(1),
        icon: methodIcons[name] ?? '🍹',
        count,
    }))
    .sort((a, b) => a.name.localeCompare(b.name)); // New: sort A–Z
---

<Layout title="By Source">
    <main class="max-w-4xl mx-auto p-8">
        <h1 class="text-4xl font-bold mb-6 text-center border-b-4 border-dotted border-zinc-400 pb-2">
            🧊 Cocktails by Source
        </h1>

        <ul class="grid gap-6 grid-cols-[repeat(auto-fill,minmax(200px,1fr))]">
            {sources.map(({ name, displayName, icon, count }) => (
                    <li class="bg-white/80 border border-zinc-300 rounded-xl p-6 shadow-md hover:shadow-lg transition text-center">
                        <a href={`/source/${name}`} class="block">
                            <div class="text-4xl mb-2">{icon}</div>
                            <h2 class="text-xl font-semibold capitalize">{displayName}</h2>
                            <p class="text-sm text-zinc-600">{count} recipe{count !== 1 ? 's' : ''}</p>
                        </a>
                    </li>
            ))}
        </ul>
    </main>
</Layout>
