---
import { getCollection } from 'astro:content';
import Layout from '@/layouts/Layout.astro';
import CocktailCard from "../../components/CocktailCard.astro";

const allCocktails = await getCollection('cocktails');

// Count drinks per glass type
const glassMap = new Map<string, number>();

for (const cocktail of allCocktails) {
    const glass = cocktail.data.glassware?.trim();
    if (!glass) continue;

    const key = glass.toLowerCase();
    glassMap.set(key, (glassMap.get(key) ?? 0) + 1);
}

// Optional icons for fun
const glassIcons: Record<string, string> = {
    coupe: 'ü•Ç',
    rocks: 'ü•É',
    highball: 'ü•§',
    martini: 'üç∏',
    flute: 'üçæ',
};

const glasses = Array.from(glassMap.entries())
    .map(([name, count]) => ({
        name,
        displayName: name.charAt(0).toUpperCase() + name.slice(1),
        icon: glassIcons[name] ?? 'üç∂',
        count,
    }))
    .sort((a, b) => b.count - a.count);
---

<Layout title="By Glassware">
    <main class="bg-[url('/parchment-texture.jpg')] bg-repeat min-h-screen p-8 text-zinc-800 font-serif">
        <section class="max-w-4xl mx-auto">
            <h1 class="text-4xl font-bold mb-6 text-center border-b-4 border-dotted border-zinc-400 pb-2">
                üç∑ Cocktails by Glassware
            </h1>

            <ul class="grid gap-6 grid-cols-[repeat(auto-fill,minmax(250px,1fr))]">
                {glasses.map(({ name, displayName, icon, count }) => (
                        <li class="bg-white/80 border border-zinc-300 rounded-xl p-6 shadow-md hover:shadow-lg transition text-center">
                            <a href={`/glassware/${name}`} class="block">
                                <div class="text-5xl mb-2">{icon}</div>
                                <h2 class="text-xl font-semibold capitalize">{displayName}</h2>
                                <p class="text-sm text-zinc-600">{count} recipe{count !== 1 ? 's' : ''}</p>
                            </a>
                        </li>
                ))}
            </ul>
        </section>
    </main>
</Layout>
