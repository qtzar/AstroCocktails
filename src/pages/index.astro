---
import { getCollection } from 'astro:content';
import Layout from '@/layouts/Layout.astro';
import { getSpiritIcon } from "../utils/spiritIcons";

const allCocktails = await getCollection('cocktails');

const spiritsMap = new Map<string, { count: number }>();

for (const drink of allCocktails) {
	const listedSpirits = Array.isArray(drink.data.spirits)
		? drink.data.spirits
		: drink.data.spirit
			? [drink.data.spirit]
			: [];

	for (const spirit of listedSpirits) {
		const key = spirit.toLowerCase();
		spiritsMap.set(key, {
			count: (spiritsMap.get(key)?.count ?? 0) + 1,
		});
	}
}


const spirits = Array.from(spiritsMap.entries())
	.map(([name, data]) => ({
		name,
		icon: getSpiritIcon(name),
		count: data.count,
	}))
	.sort((a, b) => b.name - a.name); // Sort descending by count


---

		<Layout title="Cocktail Index">
			<main class="bg-[url('/parchment-texture.jpg')] bg-repeat min-h-screen p-8 text-zinc-800 font-serif">
				<section class="max-w-6xl mx-auto">
					<h1 class="text-4xl font-bold mb-6 text-center border-b-4 border-dotted border-zinc-400 pb-2">
						ğŸ“– Cocktails By Spirit
					</h1>

					<p class="mb-8 text-center italic text-zinc-600">
						â€œA notebook of all things shaken, stirred, built and brilliant.â€
					</p>

					{spirits.length === 0 ? (
						<p class="text-center text-zinc-500 italic">No cocktails yet â€” time to get mixing!</p>
					) : (
						<ul class="grid gap-6 grid-cols-[repeat(auto-fill,minmax(200px,1fr))]">

						{spirits.map(({ name, icon, count }) => (
								<li class="bg-white/80 border border-zinc-300 rounded-xl p-6 shadow-md hover:shadow-lg transition">
									<a href={`/${name}`} class="block text-center">
										<div class="text-5xl mb-2">{icon}</div>
										<h2 class="text-xl font-semibold capitalize">{name}</h2>
										<p class="text-sm text-zinc-600">{count} recipe{count > 1 ? 's' : ''}</p>
									</a>
								</li>
							))}
						</ul>
					)}
				</section>
			</main>
		</Layout>
